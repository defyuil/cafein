<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cafein.mapper.ShipMapper">

	<!-- 출하 조회 -->
	<select id="getSHList" resultType="com.cafein.domain.ShipVO">
		<!-- select * from ship -->
		SELECT sh.shipid, sh.shipdate, sh.shipcode, sh.workcode,
		sh.stockid, st.itemid, it.itemname, it.clientcode,
		sh.shipcount, sh.shipsts, sh.membercode
		FROM ship sh
		LEFT JOIN stock st ON sh.stockid = st.stockid
		LEFT JOIN
		item it ON st.itemid = it.itemid
	</select>
	
	<!-- 출하 등록 -->
	<insert id="registSH" parameterType="com.cafein.domain.ShipVO">
		INSERT INTO ship (shipsts, workcode, clientcode, stockid, shipcount, shipdate, membercode)
		VALUES ( #{shipsts}, #{workcode}, #{cleintcode}, #{stockid}, #{shipcount}, #{shipdate}, #{membercode} )
	</insert>
	
	<!-- 출하 등록 작업지시코드 -->
	<select id="wcList" resultType="com.cafein.domain.WorkVO">
		SELECT wk.workcode, wk.clientcode, wk.itemid, wk.shipcount, wk.shipdate, wk.memvercode
		FROM work wk 보류
	</select>
	
	<!-- 작업지시 조회 -->
	<select id="getWKList" resultType="com.cafein.domain.WorkVO">
		<!-- select * from ship -->
		SELECT wk.workid, wk.workdate1, wk.workcode,
		wk.pocode, it.itemcode, it.itemname, wk.produceid, pr.produceline,
		wk.worksts, wk.workcount, wk.workdate2,
		wk.membercode
		FROM work wk
		JOIN purchaseorder po ON wk.pocode = po.pocode
		left JOIN item it ON wk.itemcode = it.itemcode
		left JOIN produce pr ON wk.produceid = pr.produceid;
	</select>
	
	<!-- 작업 지시 등록 -->
	<insert id="registWK" parameterType="com.cafein.domain.WorkVO">
		INSERT INTO work (workdate1, workcode, pocode, itemcode, workcount, workdate2, membercode)
		VALUES ( #{workdate1}, #{workcode}, #{pocode}, #{itemcode}, #{workcount}, #{workdate2}, #{membercode} )
	</insert>
	
	<!-- 작업지시 등록 수주 코드 -->
	<select id="pcList" resultType="com.cafein.domain.WorkVO">
		SELECT po.pocode, po.clientid, cli.clientname, po.itemid, it.itemname, po.pocnt
		FROM purchaseorder po
		JOIN client cli ON po.clientid = cli.clientid
		JOIN item it ON po.itemid = it.itemid;
	</select>
	
	<!-- 작업지시 코드 생성 -->
	<select id="getWKCount" resultType="int" parameterType="com.cafein.domain.WorkVO">
		select count(*) from work
		<where>
		  <choose>
			<when test="worksts == '대기'">
				and workcode like '%ST%';
			</when>
			<when test="worksts == '진행'">
				and workcode like '%PR%';
			</when>
			<when test="worksts == '완료'">
				and workcode like '%CP%';
			</when>
			<otherwise>
				and workcode like '%CC%';
			</otherwise>
		  </choose>
		</where>
	</select>
	
	<!-- 실적 조회 -->
	<select id="getPFList" resultType="com.cafein.domain.WorkVO">
		<!-- select * from ship -->
		SELECT * FROM work
	</select>

</mapper>